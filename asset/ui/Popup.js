/*! 2015 Baidu Inc. All Rights Reserved */
define("ui/Popup",["require","jquery","./lib","./Control","./painter"],function(require){var t=require("jquery"),e=require("./lib"),n=require("./Control"),i={onWindowResize:function(){clearTimeout(this._resizeTimer),this._resizeTimer=setTimeout(t.proxy(this.show,this),100)},onTargetClick:function(e){if(!this.isDisabled()){var n=e.target,i=this.target;if(i&&i!==n&&!t.contains(i,n))this.hide();var r=t(e.target),a=this.liveTriggers;if(a){for(var s=this.triggers;!r.hasClass(s)&&-1===t.inArray(n,this.liveTriggers);)n=n.parent();if(!r.hasClass(s))return}var o=new t.Event("show");if(this.fire(o),!o.isDefaultPrevented())this.show(),this.trigger=n}},onDocumentClicked:function(e){var n=e.target,i=this.main;if(i&&i!==n&&!t.contains(i,n)){var r=new t.Event("hide");if(this.fire(r),!r.isDefaultPrevented())this.hide(),clearTimeout(this._resizeTimer)}},onClick:function(t){this.fire(t)}},r=n.extend({type:"Popup",options:{disabled:!1,target:"",triggers:"",liveTriggers:"",content:"",dir:"bl",mode:"click",offset:{x:0,y:0}},init:function(t){if(t.target)this.target=e.g(t.target);if(!t.content)this.content=this.main.innerHTML;this.$parent(t)},initStructure:function(){t(this.main).appendTo(document.body).css("left","-2000px").html(this.content||this.main.innerHTML)},initEvents:function(){var t=this._resolveTriggers(this.liveTriggers||this.triggers);this.delegate(t,"click",i.onTargetClick),this.triggers=t.toArray(),this.delegate(this.main,"click",i.onClick)},repaint:require("./painter").createRepaint(n.prototype.repaint,{name:"content",paint:function(t,e){this.main.innerHTML=e||""}},{name:["triggers","liveTriggers"],paint:function(t,e,n){if(this.triggers)this.undelegate(this.triggers,"click",i.onTargetClick);e=this._resolveTriggers(n||e),this.delegate(e,"click",i.onTargetClick),this.triggers=e.toArray()}}),setTarget:function(t){return this.target=t,this},_resolveTriggers:function(n){return n=e.isString(n)?t("."+n):t(n)},show:function(){var t=this;t._computePosition.call(t),t._timer=setTimeout(function(){t.delegate(document,"click",i.onDocumentClicked),t.delegate(window,"resize",i.onWindowResize)},0)},hide:function(){t(this.main).css("left","-2000px"),this.undelegate(document,"click",i.onDocumentClicked),this.undelegate(window,"resize",i.onWindowResize),clearTimeout(this._timer),clearTimeout(this._resizeTimer)},_computePosition:function(){var e=t(this.target||this.triggers[0]),n=t(this.main),i=this.dir,r=e.offset(),a=r.top,s=r.left,o=e.outerWidth(),u=e.outerHeight(),l=s+o,c=a+u,f=s+o/2,h=a+u/2,d=n.width(),p=n.height(),g=t(window),m=g.scrollTop(),v=g.scrollLeft(),y=v+g.width(),b=m+g.height(),x=e.attr("data-popup");if(x)i=/[trbl]{2}/.test(x)?x:"1";var C,w;if("auto"===i){var k=o>d||s-(d-o)/2>0&&y>=l+(d-o)/2?"c":s+d>y?"r":"l",T=u>p||a-(p-u)/2>0&&b>=c+(p-u)/2?"c":a+p>b?"b":"t";if(b>=c+p)w="b",C=k;else if(y>=l+d)w="r",C=T;else if(a-p>=m)w="t",C=k;else if(s-d>=v)w="l",C=T;i=w+C}else w=i.charAt(0),C=i.charAt(1);var S=this.offset;if({t:1,b:1}[w])s={l:s,c:f-d/2,r:l-d}[C],a={t:a-p,b:c}[w];else if({l:1,r:1}[w])a={t:a,c:h-p/2,b:c-p}[C],s={l:s-d-S.x,r:l+S.x}[w];n.css({left:s+S.x+"px",top:a+S.y+"px"})}});return r});