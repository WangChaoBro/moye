/*! 2015 Baidu Inc. All Rights Reserved */
define("ui/log",["require","jquery","./lib"],function(require){var e=require("jquery"),t=require("./lib"),n=function(e){try{return new Function("return ("+e+")")()}catch(t){return{}}},i=function(){var t=[];return function(n){var i=t.push(document.createElement("img"))-1;t[i].onload=t[i].onerror=function(){t[i]=t[i].onload=t[i].onerror=null,delete t[i]};var r=s.action+e.param(n);t[i].src=r+"&"+(+new Date).toString(36),exports.fire("send",{url:r})}}(),r=function(t,i,r){var s,u,l=0,c=i,f=[],h=c.getAttribute("data-rsv");if(h)t.rsv=e.extend(t,{rsv:n(h)});for(var p,d=0,g=/\bOP_LOG_(TITLE|LINK|IMG|BTN|INPUT|OTHERS)\b/i;c!==r;){if("1"===c.getAttribute("data-nolog")){l=1;break}if(p=c.getAttribute("data-click"))t=e.extend(n(p),t);if(h=c.getAttribute("data-rsv"))t.rsv=e.extend(n(h),t.rsv);if(c.href)u=c.href,s="link";if("link"===s&&"H3"===c.tagName)s="title";if(g.test(c.className))s=RegExp.$1.toLowerCase();var m=1;if(c.previousSibling){var v=c.previousSibling;do{if(1===v.nodeType&&v.tagName===c.tagName)m++;v=v.previousSibling}while(v)}f[d++]=c.tagName+(m>1?m:""),c=c.parentNode}if(i!==r)if(p=r.getAttribute("data-click"))t=e.extend(n(p),t);if(l)return!l;f.reverse();var y=i.tagName.toLowerCase();if(!s&&/^(a|img|input|button|select|datalist|textarea)$/.test(y))s={a:"link"}[y]||"input",u=i.href||i.src||u;if(s=i.getAttribute("data-type")||s,!s)return!1;if(u)t.url=u;return o(t,i,"p1"),o(t,i,"act"),o(t,i,"item"),o(t,i,"mod",r.id),a(t,i,s,y,f,d),t.xpath=f.join("-").toLowerCase()+"("+s+")",t},a=function(t,n,i,r,a,o){var s="",u=function(e){return e.getAttribute("data-title")||e.title||e.textContent||e.innerText||""};if("input"===i)if(/input|textarea/.test(r)){if(s=n.value,n.type&&"password"===n.type.toLowerCase())s=""}else if(/select|datalist/.test(r)){if(n.children.length>0){var l=n.selectedIndex||0;s=n.children[l>-1?l:0].innerHTML}}else s=u(n)||n.value||"";else if(s=u(n),!s)for(var c=n,f=o;f>0;)if(f--,/^a\d*\b/i.test(a[f])){t.url=c.href,s=u(c);break}else{if(c.className&&/\bOP_LOG_[A-Z]+\b/.test(c.className)){s=u(c);break}c=c.parentNode}t.txt=e.trim(s).replace(/<[^>]+?>/g,"")},o=function(e,t,n,i){e[n]=t.getAttribute("data-"+n)||e[n]||i||"-"},s={action:"http://nsclick.baidu.com/v.gif?",main:"result-op",title:"OP_LOG_TITLE",link:"OP_LOG_LINK",img:"OP_LOG_IMG",btn:"OP_LOG_BTN",input:"OP_LOG_INPUT",others:"OP_LOG_OTHERS",data:{url:(window.location||document.location||{href:"-"}).href,pid:"-",cat:"-",page:"-",fr:"-",pvid:"-",rqid:"-",qid:"-",psid:"-",sid:"-",pn:"-",act:"-",mod:"-",item:"-",p1:"-",xpath:"-",f:"-",txt:"-",q:"-",rsv:null}},u=function(e,i){var r=n(e.getAttribute("data-click"));r.p1=i,e.setAttribute("data-click",t.stringify(r))},l=function(t,a){var o=e(a||t.target),l=s.main,c=e(o).closest("."+l);if(c.length&&"1"!==c.attr("data-nolog")){var f=o.attr("data-click");if(f)f=n(f);if(f=r(f||{},o[0],c[0])){if(s.data)f=e.extend({},s.data,f);if(!("p1"in f))e("."+s.main).each(function(e,t){if(t===c)f.p1=e+1;u(t,e+1)});exports.fire("click",{data:f,target:o[0],main:c[0]}),i(f)}}},exports={config:function(t){return e.extend(s,t),this},start:function(){return e(document).on("mousedown",l),this.fire("start"),this},stop:function(){return e(document).off("mousedown",l),this},click:function(e){return l(null,e),this},fill:function(i,r){for(var a,o,s=0;a=i[s++];){if(o=a.getAttribute("data-click"))r=e.extend(n(o),r);a.setAttribute("data-click",t.stringify(r))}return this},live:function(t){var n=this.map;if(!n)n=this.map={},this.on("click",function(e){var t=e.data.mod;if(t&&t in n)n[t](e)});return e.extend(n,t),this},send:function(n){return i(e.extend(t.clone(s.data),n)),this}};return e.extend(exports,t.observable),exports});