/*! 2015 Baidu Inc. All Rights Reserved */
define("ui/plugin/Validator",["require","jquery","./Validity","../lib"],function(require){function t(t){e.extend(this,this.options,t)}var e=require("jquery"),n=require("./Validity"),i=require("../lib");return t.prototype={constructor:t,options:{auto:!0,listen:["blur"]},execute:function(t){var n=this;n.target=t;var r=t.validate=e.proxy(n.validate,n,t);if(n.auto)i.each(n.listen,function(e){t.on(e,r)})},__onValidityChange:function(){},validate:function(t){var r=this,a=r.schema,o=t.getValue(),s=!1,u=[],l=[],c=new n;if(r.target.fire("beforevalidate",{type:"beforevalidate",validity:c}),e.isFunction(a))a=r.schema=[{type:"function",check:a}];if(i.each(a,function(n){var i=n.check(o,t);if("function"===e.type(i.then))s=!0;u.push(i),l.push(n.type)}),!s)return r.__finish(c,u,l);else return r.target.fire("validating",{type:"validating",validity:c}),e.when.apply(null,u).always(function(){var t=[].slice.call(arguments);return r.__finish(c,t,l)})},__finish:function(t,e,n){var r=this.target;i.each(e,function(e,i){t.addState(n[i],e)});var a=t.getValidState();return r.fire(a,{type:a,validity:t}),this.__updateControlState(t),t.isValid()},__updateControlState:function(t){var e=t.isValid(),n=t.getValidState(),i=!e?"valid":"invalid",r=this.target;if(!r.hasState(n))r.addState(n);if(r.hasState(i))r.removeState(i)},dispose:function(){this.target=null}},function(e){return new t(e||{})}});