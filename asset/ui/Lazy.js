/*! 2015 Baidu Inc. All Rights Reserved */
define("ui/Lazy",["require","jquery","./lib"],function(require){var e=require("jquery"),t=require("./lib"),n=function(i,r){var a=0;if(i=e(i),"none"===i.css("display"))return a;var o="offset"+t.capitalize(r||"Height");return i.children().each(function(e,t){var i=t[o];if(!i)i=n(t,r);a+=i}),a},i={compute:function(){var i={x:t.getScrollLeft(),y:t.getScrollTop()},r=this.lastScroll,a={left:i.x<r.x,top:i.y<r.y};this.lastScroll=i;var o={x:t.getViewWidth(),y:t.getViewHeight()},s=this.els;for(var u in s)if(s.hasOwnProperty(u)){var l=s[u],c=e(l[0]),f=c.offset(),h=l[2]||{};if(h.x=h.x||10,h.y=h.y||10,f.width=c.width(),f.height=c.height(),f.width>0&&0===f.height)f.height=n(l[0]);else if(0===f.width&&f.height>0)f.width=n(l[0],"Width");var p=!1,d=f.left-h.x>=i.x+o.x,g=f.top-h.y>=i.y+o.y,m=f.left+f.width+h.x<=i.x,v=f.top+h.y+f.height<=i.y;if(!(d||g||m||v)){if(!h.trigger)l[1](i,o,f,a,l[0]);p=!0}if(h.trigger)l[1](p,i,o,f,a,l)}else;},onScroll:function(){clearTimeout(this._timer),this._timer=setTimeout(this._bound.compute,this.delay),this.scrolled=!0}},r=t.newClass({type:"Lazy",tag:"data-lazy-id",initialize:function(){this.els={},this.count=0,this.delay=100,this.lastScroll={x:t.getScrollLeft(),y:t.getScrollTop()},this._bound={onScroll:e.proxy(i.onScroll,this),compute:e.proxy(i.compute,this)}},add:function(n,i,r){var a=n.getAttribute(this.tag)||t.guid();if(!this.els[a]){if(n.setAttribute(this.tag,a),this.els[a]=[n,i,r],!this.count)e(window).on("scroll",this._bound.onScroll),e(window).on("resize",this._bound.onScroll);this.count++}if(!this.scrolled)this._bound.onScroll();return this},remove:function(t){var n=t.getAttribute(this.tag);if(n in this.els)if(delete this.els[n],this.count--,!this.count)e(window).off("scroll",this.onScroll),e(window).off("resize",this.onScroll);return this}});return function(e){var t,n=function(){return t||(t=new e)};e.add=function(){return n().add.apply(t,arguments)},e.remove=function(){return n().remove.apply(t,arguments)}}(r),r});