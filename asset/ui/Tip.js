/*! 2015 Baidu Inc. All Rights Reserved */
define("ui/Tip",["require","jquery","./lib","./Control"],function(require){var t=require("jquery"),e=require("./lib"),i=require("./Control"),n={clear:function(){clearTimeout(this._showTimer),clearTimeout(this._hideTimer),clearTimeout(this._resizeTimer)},onClick:function(t){this.fire("click",{event:t})},onResize:function(){clearTimeout(this._resizeTimer);var t=this;this._resizeTimer=setTimeout(function(){t.show(t.current)},100)},onDocClick:function(e){var i=this.main,r=t(e.target).closest("."+this.flag);if(!(r.is(i)||~t.inArray(r[0],this.triggers)||t.contains(i,r)))n.onHide.call(this)},onShow:function(e){var i=t(e.target).closest("."+this.flag);if(n.clear.call(this),i.length&&!i.is(this.current)){var r=this.events,s=this._bound;if(r){if(i.on(r.un,s.onHide).off(r.on,s.onShow),this.current)t(this.current).on(r.on,s.onShow).off(r.un,s.onHide);if("click"===this.mode)t(document).on("click",s.onDocClick)}i=i[0];var a=new t.Event("beforeShow",{target:i,event:e});this.fire(a),i=this.current=a.target||i;var o=this.showDelay;if(o){var l=this;this._showTimer=setTimeout(function(){l.show(i)},o)}else this.show(i)}},onHide:function(){var t=this;if(n.clear.call(t),this.hideDelay)this._hideTimer=setTimeout(function(){t.hide()},this.hideDelay);else this.hide()},onMouseEnter:function(){n.clear.call(this)},onMouseLeave:function(){var t=this;if(n.clear.call(t),this.hideDelay)t._hideTimer=setTimeout(function(){t.hide()},this.hideDelay);else t.hide()},computePosition:function(){var i=t(this.current),n=t(this.main),r=this.elements.arrow,s=this.arrow,a=i.offset(),o=a.top,l=a.left,u=i.width(),c=i.height(),h=l+u,f=o+c,d=l+u/2,p=o+c/2,g=n.width(),m=n.height(),v=r.firstChild.offsetWidth,y=r.firstChild.offsetHeight,b=e.getScrollTop(),x=e.getScrollLeft(),C=x+e.getViewWidth(),w=b+e.getViewHeight(),T=i.attr("data-tooltips");if(T)s=/[trblc]{2}/.test(T)?T:"1";var k,S;if(!s||"1"===s){var N=u>g||l-(g-u)/2>0&&C>=h+(g-u)/2?"c":l+g>C?"r":"l",_=c>m||o-(m-c)/2>0&&w>=f+(m-c)/2?"c":o+m>w?"b":"t";if(w>=f+y+m)S="b",k=N;else if(C>=h+g+v)S="r",k=_;else if(o-m-y>=b)S="t",k=N;else if(l-g-v>=x)S="l",k=_;s=S+k}else S=s.charAt(0),k=s.charAt(1);var P={l:"left",r:"right",t:"top",b:"bottom"},E=this.offset,M=this.helper;if(r.className=""+M.getPartClassName("arrow")+" "+M.getPartClassName("arrow-"+P[S]),v=r.firstChild.offsetWidth,y=r.firstChild.offsetHeight,{t:1,b:1}[S]){l={l:l+E.x,c:d-g/2,r:h-g-E.x}[k],o={t:o-y-m-E.y,b:f+y+E.y}[S];var D=(u-v)/2;r.style.left={c:(g-v)/2,l:D-E.x,r:g-Math.max(v,D)+E.x}[u>g?"c":k]+"px",r.style.top=""}else if({l:1,r:1}[S]){o={t:o+E.y,c:p-m/2,b:f-m-E.y}[k],l={l:l-v-g-E.x,r:h+v+E.x}[S];var A=(c-y)/2;r.style.top={c:(m-y)/2,t:A-E.y,b:m-Math.max(y,A)+E.y}[c>m?"c":k]+"px",r.style.left=""}n.css({left:l+"px",top:o+"px"})}},r=i.extend({type:"Tip",options:{disabled:!1,arrow:!1,showDelay:100,hideDelay:300,mode:"over",title:null,content:"",triggers:"tooltips",flag:"_ecui_tips",offset:{x:0,y:0}},init:function(i){this.$parent(i),this.hideDelay=this.hideDelay<0?r.HIDE_DELAY:this.hideDelay,this.events={over:{on:"mouseenter",un:"mouseleave"},click:{on:"click",un:"click"}}[this.mode];var s=this,a=this._bound={};e.each(n,function(e,i){if(/^on/.test(i))a[i]=t.proxy(e,s)})},initStructure:function(){var e=this,i=e.helper,n=""+i.getPartHTML("arrow","div","<em></em><ins></ins>")+i.getPartHTML("title","div",e.title||"")+i.getPartHTML("body","div",e.body||"");if(t(e.main).css("left","-2000px").html(n).appendTo(document.body),e.elements={arrow:i.getPart("arrow"),title:i.getPart("title"),body:i.getPart("body")},!this.title)t(i.getPart("title")).hide();if(!e.events&&e.triggers)if(e.showDelay)e._showTimer=setTimeout(function(){e.show(e.triggers[0])});else e.show(e.triggers[0])},initEvents:function(){var e=this._bound,i=t(this.main);if(i.on("click",e.onClick),"over"===this.mode)i.on("mouseenter",e.onMouseEnter),i.on("mouseleave",e.onMouseLeave);var n=this.triggers;this.triggers=[],this.addTriggers(n)},addTriggers:function(e){var i=this.events,n=this.flag;if(this.triggers=[].concat(e,this.triggers),i){e="string"==typeof e?t("."+e):t(e);var r=this._bound.onShow;e.each(function(e,s){if(s=t(s),!s.hasClass(n))s.addClass(n),s.on(i.on,r)})}},refresh:function(e,i){var n=this.events,r=this._bound;if(e="string"==typeof e?t("."+e,i):t(e),n){if(this.triggers)e.each(function(e,i){if(i=t(i),!i.parent().length)i.off(n.on,r.onShow),i.off(n.un,r.onHide)});this.addTriggers(e)}},show:function(e){this.elements;n.clear.call(this),this.current=e,t(window).on("resize",this._bound.onResize),n.computePosition.call(this),this._visible=!0,this.fire("show",{target:e})},hide:function(){var e=this.main,i=this.events,r=this.current,s=this._bound;if(i&&r)if(t(r).on(i.on,s.onShow).off(i.un,s.onHide),"click"===this.mode)t(document).off("click",s.onDocClick);n.clear.call(this);var a=this.elements.arrow;e.style.left=-e.offsetWidth-a.offsetWidth+"px",this._visible=!1,this.current=null,t(window).off("resize",s.onResize),this.fire("hide")},isVisible:function(){return!!this._visible},setTitle:function(e){this.title=e||"",t(this.elements.title)[this.title?"show":"hide"]().html(this.title)},setContent:function(t){this.content=t||"",this.elements.body.innerHTML=this.content},dispose:function(){var i=this.events,n=this._bound;if(i){var r=this.flag;e.each(this.triggers||[],function(e){e=t(e),e.hasClass(r)&&e.removeClass(r).off(i.on,n.onShow)});var s=this.main;if("over"===this.mode)t(s).off("mouseenter",n.onMouseEnter),t(s).off("mouseleave",n.onMouseLeave);else t(document).off("click",n.onDocClick);this.current=null,this.$parent()}}});return r});