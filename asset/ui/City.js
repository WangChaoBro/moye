/*! 2015 Baidu Inc. All Rights Reserved */
define("ui/City",["require","jquery","./lib","./Control","./Popup","./painter"],function(require){var e=require("jquery"),t=require("./lib"),n=require("./Control"),r=require("./Popup"),i=["热门|上海,北京,广州,昆明,西安,成都,深圳,厦门,乌鲁木齐,南京,重庆,杭州,大连,长沙,海口,哈尔滨,青岛,沈阳,三亚,济南,武汉,郑州,贵阳,南宁,福州,天津,长春,石家庄,太原,兰州","A-G|安庆,阿勒泰,安康,鞍山,安顺,安阳,阿克苏,包头,蚌埠,北海,北京,百色,保山,博乐,长治,长春,长海,常州,昌都,朝阳,潮州,常德,长白山,成都,重庆,长沙,赤峰,大同,大连,达县,大足,东营,大庆,丹东,大理,敦煌,鄂尔多斯,恩施,二连浩特,佛山,福州,阜阳,富蕴,贵阳,桂林,广州,广元,赣州,格尔木,广汉,固原","H-L|呼和浩特,哈密,黑河,海拉尔,哈尔滨,海口,衡阳,黄山,杭州,邯郸,合肥,黄龙,汉中,和田,惠州,吉安,吉林,酒泉,鸡西,晋江,锦州,景德镇,嘉峪关,井冈山,济宁,九江,佳木斯,济南,喀什,昆明,康定,克拉玛依,库尔勒,喀纳斯,库车,兰州,洛阳,丽江,梁平,荔波,庐山,林芝,柳州,泸州,连云港,黎平,连城,拉萨,临沧,临沂","M-T|牡丹江,芒市,满洲里,绵阳,梅县,漠河,南京,南充,南宁,南阳,南通,那拉提,南昌,宁波,攀枝花,衢州,秦皇岛,庆阳,且末,齐齐哈尔,青岛,汕头,深圳,石家庄,三亚,沈阳,上海,思茅,鄯善,韶关,沙市,苏州,唐山,铜仁,通化,塔城,腾冲,台州,天水,天津,通辽,太原,吐鲁番","W-Z|威海,武汉,梧州,文山,无锡,潍坊,武夷山,乌兰浩特,温州,乌鲁木齐,芜湖,万州,乌海,兴义,西昌,厦门,香格里拉,西安,襄阳,西宁,锡林浩特,西双版纳,徐州,兴城,兴宁,邢台,义乌,永州,榆林,延安,运城,烟台,银川,宜昌,宜宾,盐城,延吉,玉树,伊宁,伊春,珠海,昭通,张家界,舟山,郑州,中卫,芷江,湛江,中甸,遵义"],o=n.extend({type:"City",options:{index:0,activeClass:"active",autoFill:!0,hideCities:null},init:function(e){this.$parent(e);var t=this.main;if(t&&"INPUT"===t.tagName){var n=document.createElement("div"),r=t.parentNode;if(r)r.insertBefore(n,t);n.appendChild(t),this.input=t,this.main=n}this.tabs=this.autoFill?i.slice():[]},initStructure:function(){var t=e(this.main),n=this.input;if(!n)n=this.input=e('<input type="text">').appendTo(t).get(0);if(n.setAttribute("autocomplete","off"),this.name)n.name=this.name;var i=this.popup=new r({target:n,triggers:[n]}).render();this.helper.addPartClasses("popup",i.main)},initEvents:function(){this.popup.on("click",e.proxy(this._onPopupClick,this)).on("show",e.proxy(this._onPopupShow,this))},setReadOnly:function(e){this.$parent(e),this.input.readOnly=!!e},repaint:require("./painter").createRepaint(n.prototype.repaint,{name:"value",paint:function(e,t){this.setValue(t)}}),fill:function(e){var n=this.tabs;if(t.isString(e))n.push(e);else this.tabs=e;return this},_pick:function(t){var n=t.innerHTML,r=new e.Event("pick",{target:this,value:n});if(this.fire(r),!r.isDefaultPrevented()){var i=this.input;i.value=n,i.focus(),this.hide(),this.fire("change")}},_changeTab:function(t){var n=this.labels,r=this.panels,i=this.index,o=this.helper.getPartClassName(this.activeClass);if(t!==i)e(n[i]).removeClass(o),e(r[i]).removeClass(o),i=this.index=t,e(n[i]).addClass(o),e(r[i]).addClass(o)},show:function(){this.popup.show()},hide:function(){this.popup.hide()},setValue:function(e){return this.input.value=e||"",this},getValue:function(){return this.input.value},_onPopupClick:function(t){var n=e(t.target),r=n.prop("tagName"),i=n.data("idx"),o=this.helper.getPartClassName(this.activeClass);switch(r){case"A":t.preventDefault(),n.hasClass(o)?this.hide():this._pick(t.target);break;case"LI":if(i!==this.index)this._changeTab(i)}},_onPopupShow:function(t){if(!this.isDisabled()){var n=new e.Event("show");if(this.fire(n),n.isDefaultPrevented())return void t.preventDefault();if(!this.labels){var r=this.popup;r.set("content",this._build(this.tabs));var i=r.main.getElementsByTagName("ul");this.labels=i[0].getElementsByTagName("li"),this.panels=i[1].getElementsByTagName("li")}}},_build:function(){var e=this.helper,n=this.index,r=[],i=[];r.push('<ul class="'+e.getPartClassName("labels")+'">'),i.push('<ul class="'+e.getPartClassName("panels")+'">');var o=",",a=this.hideCities;if(a)a=o+a.replace(/\s+/g,"")+o;var s=function(e){return t.map(e.split(o),function(e){return!a||!~a.indexOf(o+e+o)?'<a href="#" title="'+e+'">'+e+"</a>":""}).join("")},u=e.getPartClassName(this.activeClass);return t.each(this.tabs,function(e,t){var o='<li data-idx="'+t+'" class="'+(t===n?u:"")+'"';e=e.split("|"),r.push(o+">"+e[0]+"</li>"),i.push(o+">"+s(e[1])+"</li>")}),r.push("</ul>"),i.push("</ul>"),r.join("")+i.join("")}});return o});