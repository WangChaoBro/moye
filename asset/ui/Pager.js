/*! 2015 Baidu Inc. All Rights Reserved */
define("ui/Pager",["require","jquery","./Control","./painter","./lib"],function(require){var t=require("jquery"),e=require("./Control"),n=require("./painter"),i=require("./lib"),r=e.extend({type:"Pager",options:{page:0,first:0,padding:1,showAlways:!0,showCount:5,total:0,disabledClass:"disabled",lang:{prev:"上一页",next:"下一页",ellipsis:".."}},init:function(e){this.$parent(e);var n=t(this.main);this.showCount=+this.showCount,this.total=+this.total||n.data("total")||0,this.padding=+this.padding||0,this.page=+this.page||n.data("page")||0,this.first&=1},initEvents:function(){this.delegate(this.main,"click",this._onMainClicked)},repaint:n.createRepaint(e.prototype.repaint,{name:["page","total"],paint:function(e,n,i){var r=t(this.main);if(this.page=Math.max(Math.min(n-this.first,this.total-1),0),2>i&&!this.showAlways)r.hide();else r.html(this._build()).show()}}),setPage:function(t){this.set("page",t)},getPage:function(){return this.page+this.first},setTotal:function(t){this.set({page:0,total:+t})},getTotal:function(){return this.total},getItemText:function(t,e){return this.lang[e]||t},getItemHTML:function(t,e){var n=this.helper,r=[].slice.call(arguments,1).concat("item"),a=i.reduce(r,function(t,e){if(e)t.push(n.getPartClassName(e));return t},[]),o=t+this.first;return'<a href="#" data-page="'+o+'" class="'+a.join(" ")+'">'+this.getItemText(t+1,e||"item")+"</a>"},_build:function(){var t=this.page,e=this.total,n=this.padding,r=this.showCount;r=r>e?e:r;var a=Math.floor(r/2),o=n,s=a,u=n,l=a,c=t-a;if(0>c)s+=c,l-=c;var f=t+a+1-e;if(f>0)s+=f,l-=f;var h=this.range(0,t,o,s),d=this.range(t+1,e,l,u),p=i.map(h.concat(t).concat(d),function(e){return 0>e?this.getItemHTML(-e,"ellipsis"):this.getItemHTML(e,e===t?"current":"")},this);return""+this.getItemHTML(Math.max(t-1,0),"prev",t>0?"":"disabled")+p.join("")+this.getItemHTML(Math.min(t+1,e-1),"next",e-1>t?"":"disabled")},range:function(t,e,n,r){return e-r>t+n?i.range(t,t+n).concat(-t-n).concat(i.range(e-r,e)):i.range(t,e)},_onMainClicked:function(e){e.preventDefault();var n=t(e.target).closest("a",this.main),i=this.helper;if(n.length&&!n.hasClass(i.getPrimaryClassName("current"))){var r=n.data("page"),a=new t.Event("change",{page:r});if(this.fire(a),!a.isDefaultPrevented())this.page=null,this.set("page",r)}}});return r});