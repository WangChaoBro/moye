/*! 2015 Baidu Inc. All Rights Reserved */
define("ui/CalendarExtension",["require","jquery","./lib","./Control","./Calendar"],function(require){var e=require("jquery"),t=require("./lib"),n=require("./Control"),r=require("./Calendar"),i={onShow:function(){this.show(this.target,!0)},onHide:function(){this.hide()},onClick:function(t){var n=e(t.target);if(n.is("a"))if(t.stopPropagation(),this.fire("click",{target:n.get(0)}),this.check(n)){var r=n.html();this.target.innerHTML=r,this.select(r),this.hide(),this.fire("pick",{value:r,target:this.target})}}},o=n.extend({type:"Calendar.Menu",options:{start:1,end:12,className:"",selectedClass:"current"},init:function(t){this.main=e("<div>").addClass(t.className).get(0),this.bindEvents(i)},render:function(){var n=this.options;if(!this.rendered){this.rendered=!0,this.build(n.start,n.end);var r=this._bound,i=e(this.main).on("mouseenter",r.onShow).on("mouseleave",r.onHide).on("click",r.onClick);if(this.elements=i.find("a").toArray(),n.target)this.setTarget(t.g(n.target))}return this},build:function(t,n){if(e.isArray(t))n=t[1],t=t[0];this.start=t,this.end=n;for(var r=[],i=t;n>=i;i++)r.push('<a href="#">'+i+"</a>");this.fire("build",{html:r}),this.main.innerHTML=r.join("")},setTarget:function(e){if(e)this.target=e},select:function(t){var n=this.options,r=n.selectedClass,i=e("."+r,this.main),o=i.html();if(i.removeClass(r),o!==t){var a=this.elements[t-this.start];a&&e(a).addClass(r)}},show:function(t,n){!n&&this.fire("beforeShow",{target:t});var r=e(this.main);if(t!==this.target)this.setTarget(t),e(t).parent().parent().append(r);this.select(0|t.innerHTML),r.show()},hide:function(){e(this.main).hide()},check:function(){return!0}});o.month=function(e){var t=new o(e);return t.render()},o.year=function(t){var n=new o(t),r=20,i=function(e){var t=e%r,n=e-t+1,i=n+r-1;return[n,i]};return n.on("build",function(e){var t=e.html;t.push('<a href="#" data-cmd="prev">&lt;</a>'),t.push('<a href="#" data-cmd="back">返回</a>'),t.push('<a href="#" data-cmd="next">&gt;</a>')}),n.on("beforeShow",function(e){var t=e.target,n=0|t.innerHTML;this.build(i(n))}),n.on("click",function(e){var t=e.target.getAttribute("data-cmd");switch(t){case"prev":this.build(i(this.start-r));break;case"next":this.build(i(this.start+r));break;case"back":this.build(i(0|this.target.innerHTML))}}),n.check=function(t){return!e(t).attr("data-cmd")},n.render()};var a={renderMenu:function(t,n){var r=this.menus[n];if(!r){r=this.menus[n]=o[n]({className:"menu-"+n+"-options"});var i=this.calendar;r.on("pick",function(t){var n=t.target.parentNode,r=n.getElementsByTagName("a"),o=0|r[0].innerHTML,a=0|r[1].innerHTML,s=n.parentNode;e("."+s.className,s.parentNode).each(function(e,t){if(t===s){var n=new Date(o,a-1,1);n.setMonth(a-e-1),i.setValue(n)}})})}r.show(t)},onOver:function(t){var n=t.target,r=n.getAttribute("data-menu-type");if(r){a.renderMenu.call(this,n,r);var i=this._bound;e(this.main).off("mouseover",i.onOver).on("mouseout",i.onOut)}},onOut:function(t){var n=t.target,r=n.getAttribute("data-menu-type");if(r){var i=this.menus[r],o=this._bound;i&&i.hide(),e(this.main).on("mouseover",o.onOver).off("mouseout",o.onOut)}},onClick:function(e){a.onHide.call(this,e)},onHide:function(){t.each(this.menus,function(e){e.hide()})}},s=t.newClass({initialize:function(e){e=e||{},e.lang=e.lang||{},e.lang.title='<a href="#" data-menu-type="year" class="{prefix}-menu-year-handler">{year}</a>年<a href="#" data-menu-type="month" class="{prefix}-menu-month-handler">{month}</a>月',this.calendar=new r(e),this.menus={},n.prototype.bindEvents.call(this,a)},render:function(){var t=this.calendar,n=t.render.apply(t,arguments),r=this.main=t.main,i=this._bound;return e(r).on("mouseover",i.onOver).on("mouseout",i.onOut).on("click",i.onClick),t.on("hide",i.onHide),n},dispose:function(){t.each(this.menus,function(e){e.dispose()});var n=this._bound;e(this.main).off("mouseover",n.onOver).off("mouseout",n.onOut).off("click",n.onClick),this.calendar.un("hide",n.onHide),this.calendar.dispose()}});return s});