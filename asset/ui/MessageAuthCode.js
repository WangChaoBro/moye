/*! 2015 Baidu Inc. All Rights Reserved */
define("ui/MessageAuthCode",["require","./Control","jquery"],function(require){var e=require("./Control"),t=require("jquery"),n=e.extend({type:"MessageAuthCode",options:{text:{normal:"获取校验码",cooldown:"(${time}秒后)重新获取",sending:"正在发送...",success:"校验码已发送",fail:"服务异常，稍候再试"},cooldown:6e4,interval:1e3,main:"",send:""},init:function(e){var n=this;t.extend(n,e),n.main=t(n.main).get(0),n.send=e.send,n.text=e.text},initEvents:function(){var e=this,n=t(e.main),i=t.proxy(e._onSendSuccess,e),r=t.proxy(e._onSendFail,e);n.on("click",function(){if(!e.hasState("disabled"))e.addState("disabled")._showMessage(e.text.sending),e.send.call(e).then(i,r)})},_cooldown:function(){var e=this,t=e.interval;return e._clearCooldown(),e._cooldownCounter=e.cooldown,e._cooldownTimer=setInterval(function(){e._cooldownCounter-=t;var n=e._cooldownCounter;if(n>0)return void e._showMessage(e.text.cooldown.replace(/\${time}/g,n/t));else return void e.reset()},t),e},_clearCooldown:function(){var e=this;if(e._cooldownCounter=0,e._cooldownTimer)clearInterval(e._cooldownTimer),e._cooldownTimer=0;return e},_onSendSuccess:function(){var e=this;e._showMessage(e.text.success),setTimeout(function(){e._cooldown()},1e3)},_onSendFail:function(){this._showMessage(this.text.fail),this.removeState("disabled")},_showMessage:function(e){return t(this.main).text(e),this},reset:function(){return this._clearCooldown(),this._showMessage(this.text.normal),this.removeState("disabled"),this}});return n});