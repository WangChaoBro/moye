<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>CalendarExtension - Moye</title>
<link rel="stylesheet" href="./css/common.css" />
<script src="./js/esl.js"></script>
<script src="./js/jquery-1.10.2.min.js"></script>
<script>
require.config({ 'baseUrl': '../asset' });
</script>
<link rel="stylesheet" href="../asset/css/CalendarExtension.css">
<style>
  .line input {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    padding: 4px 5px;
    height: 16px;
    line-height: 16px;
    margin: 0;
    outline: none;
  }
  
  .line button {
    margin-left: 10px;
  }

  .line {
    margin: 10px 0;
  }
</style>
</head>
<body>
<div class="nav">
    <a href="#" class="logo"><img src="./img/moye.png" alt=""></a>
    <ul>
        <li><a href="Button.html" class="">Button</a>
        <li><a href="Calendar.html" class="">Calendar</a>
        <li><a href="City.html" class="">City</a>
        <li><a href="Dialog.html" class="">Dialog</a>
        <li><a href="Pager.html" class="">Pager</a>
        <li><a href="Slider.html" class="">Slider</a>
        <li><a href="Select.html" class="">Select</a>
        <li><a href="Tabs.html" class="">Tabs</a>
        <li><a href="TextBox.html" class="">TextBox</a>
    </ul>
</div>
<div class="container">
    <div id="main">
<div class="markdown"><h1 id="calenderextension-">CalenderExtension 扩展版日历</h1>
<p>扩展版日历可以快速选择年份与月份</p>
<h3 id="demo">DEMO</h3>
<hr>
</div><div class="content">
  <div class="line">
    <input type="text" class="calendar-trigger" />
    <button type="button" class="calendar-trigger">click</button>
    <input type="text" class="calendar-trigger" />
    <button type="button" class="calendar-trigger">click</button>
  </div>

  <div class="line live-holder">
    <input type="text" class="calendar-target calendar-trigger1" />
    <button type="button" class="calendar-trigger1">click</button>
  </div>

  <button type="button" class="create-button">create button</button>
  <div class="embed-calendar-holder"></div>
</div>

<div class="markdown"><h3 id="-">源码</h3>
<hr>
<pre><code class="lang-html">&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"line"</span>&gt;
  &lt;input <span class="class"><span class="keyword">type</span>=</span><span class="string">"text"</span> <span class="class"><span class="keyword">class</span>=</span><span class="string">"calendar-trigger"</span> /&gt;
  &lt;button <span class="class"><span class="keyword">type</span>=</span><span class="string">"button"</span> <span class="class"><span class="keyword">class</span>=</span><span class="string">"calendar-trigger"</span>&gt;click&lt;/button&gt;
&lt;/div&gt;
&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"line"</span>&gt;
  &lt;input <span class="class"><span class="keyword">type</span>=</span><span class="string">"text"</span> <span class="class"><span class="keyword">class</span>=</span><span class="string">"calendar-trigger"</span> /&gt;
  &lt;button <span class="class"><span class="keyword">type</span>=</span><span class="string">"button"</span> <span class="class"><span class="keyword">class</span>=</span><span class="string">"calendar-trigger"</span>&gt;click&lt;/button&gt;
&lt;/div&gt;

&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"line live-holder"</span>&gt;
  &lt;input <span class="class"><span class="keyword">type</span>=</span><span class="string">"text"</span> <span class="class"><span class="keyword">class</span>=</span><span class="string">"calendar-target calendar-trigger1"</span> /&gt;
  &lt;button <span class="class"><span class="keyword">type</span>=</span><span class="string">"button"</span> <span class="class"><span class="keyword">class</span>=</span><span class="string">"calendar-trigger1"</span>&gt;click&lt;/button&gt;
&lt;/div&gt;

&lt;button <span class="class"><span class="keyword">type</span>=</span><span class="string">"button"</span> <span class="class"><span class="keyword">class</span>=</span><span class="string">"create-button"</span>&gt;create button&lt;/button&gt;
&lt;div <span class="class"><span class="keyword">class</span>=</span><span class="string">"embed-calendar-holder"</span>&gt;&lt;/div&gt;
</code></pre>
<pre><code class="lang-js"><span class="built_in">require</span>([<span class="string">'CalendarExtension'</span>], <span class="function"><span class="keyword">function</span> <span class="params">(CalendarExtension)</span> </span>{

  <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>);

  <span class="keyword">var</span> addDays = <span class="function"><span class="keyword">function</span> <span class="params">(date, days)</span> </span>{
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(date.getTime() + days * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);
  };

  <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>();
  <span class="keyword">var</span> begin = [now, addDays(now, <span class="number">89</span>)];
  <span class="keyword">var</span> end = [addDays(now, <span class="number">1</span>), addDays(now, <span class="number">90</span>)];

  <span class="keyword">var</span> triggers = $(<span class="string">'.calendar-trigger'</span>);

  <span class="keyword">new</span> CalendarExtension({
    prefix: <span class="string">'ecl-ui-cal'</span>,
    <span class="comment">// W为星期几，WW带周作前缀</span>
    dateFormat: <span class="string">'yyyy-MM-dd(WW)'</span>,
    triggers: triggers.toArray(),
    <span class="comment">//value: '2012-03-30',</span>
    <span class="comment">// 显示几个月</span>
    <span class="comment">//monthes: 3,</span>
    <span class="comment">// 一周的开始日，默认为周日</span>
    first: <span class="number">1</span>,
    lang: {
      days: <span class="string">'一,二,三,四,五,六,日'</span>
    },
    <span class="comment">// range: {</span>
    <span class="comment">//   begin: '2013-03-25',</span>
    <span class="comment">//   end: '2013-07-25'</span>
    <span class="comment">// },</span>
    <span class="comment">// 如果要处理节日</span>
    process: <span class="function"><span class="keyword">function</span> <span class="params">(el, classList, dateString)</span> </span>{
      <span class="keyword">var</span> festivals = {
        <span class="string">'2013-03-08'</span>: <span class="string">'三八'</span>,
        <span class="string">'2013-04-04'</span>: <span class="string">'清明'</span>,
        <span class="string">'2013-05-01'</span>: <span class="string">'劳动'</span>,
        <span class="string">'2013-10-01'</span>: <span class="string">'国庆'</span>
      };

      <span class="keyword">if</span> ( festivals[dateString] ) {
        <span class="comment">// 改变文字显示，你也可以通过push一个class到classList 以便改为预设的class</span>
        el.innerHTML = festivals[dateString];
      }
    },
    <span class="comment">// 不指定 target 时，需要在本事件中动态指定</span>
    onBeforeShow: <span class="function"><span class="keyword">function</span> <span class="params">(arg)</span> </span>{
      <span class="keyword">var</span> e = arg.event;
      <span class="keyword">var</span> target = e.target;

      <span class="comment">// 更新定位及赋值关联的目标 target</span>
      target = target.tagName === <span class="string">'INPUT'</span> &amp;&amp; target.type === <span class="string">'text'</span>
               ? target
               : $(target).prev().get(<span class="number">0</span>);

      <span class="keyword">this</span>.setTarget(target);

      <span class="keyword">if</span> ( target === triggers[<span class="number">0</span>] ) {
          <span class="comment">// 设定开始的范围</span>
          <span class="keyword">this</span>.setRange({begin: begin[<span class="number">0</span>], end: begin[<span class="number">1</span>]});
      }
      <span class="keyword">else</span> {
          <span class="keyword">if</span> (triggers[<span class="number">0</span>].value) {
            <span class="keyword">var</span> date = <span class="keyword">this</span>.from(triggers[<span class="number">0</span>].value);
            <span class="comment">// 在开始日期的后一天</span>
            end[<span class="number">0</span>] = addDays(date, <span class="number">1</span>);
            <span class="comment">// 开始日期的30天结束</span>
            end[<span class="number">1</span>] = addDays(date, <span class="number">30</span>);
          }

          <span class="comment">// 设定结束的范围</span>
          <span class="keyword">this</span>.setRange({begin: end[<span class="number">0</span>], end: end[<span class="number">1</span>]});
      }
    },
    <span class="comment">// 选取日期的后续处理</span>
    <span class="comment">// arg = { value:, week:, date: }</span>
    onPick: <span class="function"><span class="keyword">function</span> <span class="params">(arg)</span> </span>{
      <span class="keyword">var</span> target = <span class="keyword">this</span>.target;
      <span class="keyword">if</span> ( target === triggers[<span class="number">0</span>] &amp;&amp; triggers[<span class="number">2</span>].value &lt;= target.value) {
          triggers[<span class="number">2</span>].value = <span class="keyword">this</span>.format(addDays(arg.date, <span class="number">1</span>));
      }
    }
  }).render();

  <span class="keyword">new</span> CalendarExtension({
    prefix: <span class="string">'ecl-ui-cal'</span>,
    main: $(<span class="string">'.embed-calendar-holder'</span>)[<span class="number">0</span>],
    triggers: <span class="string">'calendar-trigger1'</span>,
    liveTriggers: $(<span class="string">'.live-holder'</span>)[<span class="number">0</span>],
    target: $(<span class="string">'.calendar-target'</span>)[<span class="number">0</span>],
    onHide: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
      <span class="built_in">console</span>.log(<span class="string">'hided'</span>);
    }
  }).render();

  $(<span class="string">'.create-button'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
    <span class="keyword">var</span> btn = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>)
    btn.className = <span class="string">'calendar-trigger1'</span>;
    btn.innerHTML = <span class="string">'new btn'</span>;
    $(<span class="string">'.live-holder'</span>)[<span class="number">0</span>].appendChild(btn);
  });

});
</code></pre>
</div>    </div>
    <div id="dark-bg">
        <div id="top-nav">
            <ul id="lang-nav" class="ui-tabs" data-ctrl-context="default" data-ctrl-id="moye-8">
                <li class="ui-tabs-item ui-tabs-item-first ui-tabs-active" data-index="0">js</li>
                <li class="ui-tabs-item" data-index="1">html</li>
            </ul>
        </div>
    </div>
</div>
<script>
require(['jquery', 'ui/lib', 'ui/Tabs'], function ($, lib, Tabs) {
    lib.fixed($('.nav')[0], {
        top: 0,
        left: 0,
        bottom: 0
    });

    var tabs = [{
        title: 'js'
    }, {
        title: 'html'
    }];

    new Tabs({
        main: document.getElementById('lang-nav'),
        tabs: tabs
    }).render().on('change', function (e) {
        switchCode(tabs[e.activeIndex].title);
    });

    function switchCode(title) {
        $('pre code').each(function () {
            var code = $(this);
            var pre = code.parent();
            if (code.hasClass('lang-' + title)) {
                pre.show();
            }
            else {
                pre.hide();
            }
        });
    }
});
</script>
<script>
require(['ui/CalendarExtension'], function (CalendarExtension) {

  var $ = require('jquery');

  var addDays = function (date, days) {
    return new Date(date.getTime() + days * 24 * 60 * 60 * 1000);
  };

  var now = new Date();
  var begin = [now, addDays(now, 89)];
  var end = [addDays(now, 1), addDays(now, 90)];

  var triggers = $('.calendar-trigger');

  new CalendarExtension({
    prefix: 'ecl-ui-cal',
    // W为星期几，WW带周作前缀
    dateFormat: 'yyyy-MM-dd(WW)',
    triggers: triggers.toArray(),
    //value: '2012-03-30',
    // 显示几个月
    //monthes: 3,
    // 一周的开始日，默认为周日
    first: 1,
    lang: {
      days: '一,二,三,四,五,六,日'
    },
    // range: {
    //   begin: '2013-03-25',
    //   end: '2013-07-25'
    // },
    // 如果要处理节日
    process: function (el, classList, dateString) {
      var festivals = {
        '2013-03-08': '三八',
        '2013-04-04': '清明',
        '2013-05-01': '劳动',
        '2013-10-01': '国庆'
      };

      if ( festivals[dateString] ) {
        // 改变文字显示，你也可以通过push一个class到classList 以便改为预设的class
        el.innerHTML = festivals[dateString];
      }
    },
    // 不指定 target 时，需要在本事件中动态指定
    onBeforeShow: function (arg) {
      var e = arg.event;
      var target = e.target;

      // 更新定位及赋值关联的目标 target
      target = target.tagName === 'INPUT' && target.type === 'text'
               ? target
               : $(target).prev().get(0);

      this.setTarget(target);

      if ( target === triggers[0] ) {
          // 设定开始的范围
          this.setRange({begin: begin[0], end: begin[1]});
      }
      else {
          if (triggers[0].value) {
            var date = this.from(triggers[0].value);
            // 在开始日期的后一天
            end[0] = addDays(date, 1);
            // 开始日期的30天结束
            end[1] = addDays(date, 30);
          }

          // 设定结束的范围
          this.setRange({begin: end[0], end: end[1]});
      }
    },
    // 选取日期的后续处理
    // arg = { value:, week:, date: }
    onPick: function (arg) {
      var target = this.target;
      if ( target === triggers[0] && triggers[2].value <= target.value) {
          triggers[2].value = this.format(addDays(arg.date, 1));
      }
    }
  }).render();

  new CalendarExtension({
    prefix: 'ecl-ui-cal',
    main: $('.embed-calendar-holder')[0],
    triggers: 'calendar-trigger1',
    liveTriggers: $('.live-holder')[0],
    target: $('.calendar-target')[0],
    onHide: function () {
      console.log('hided');
    }
  }).render();

  $('.create-button').on('click', function () {
    var btn = document.createElement('button')
    btn.className = 'calendar-trigger1';
    btn.innerHTML = 'new btn';
    $('.live-holder')[0].appendChild(btn);
  });

});
</script></body>
</html>
